<template>
    <Layout>
        <section class="text-gray-600 body-font dark:text-gray-100">
            <div class="container px-5 py-24 mx-auto">
                <Link href="/" class="flex items-center text-gray-900 mb-4 md:mb-0">
                    <CornerUpLeft class="size-4 mr-1 text-gray-500 dark:text-gray-300"/>
                    <span class="text-sm text-gray-500 dark:text-gray-300">
                        Back to All Dishes
                    </span>
                </Link>

                <div class="flex flex-col text-center w-full mb-20">
                    <h2 class="text-xs text-indigo-500 dark:text-blue-400 tracking-widest font-medium title-font mb-1">
                        DISH DETAILS</h2>
                    <h1 class="sm:text-3xl text-2xl font-medium title-font text-gray-900 dark:text-gray-100">
                        {{ dish.name }}</h1>
                    <div v-if="dish.image"
                         class="w-full max-w-4xl mx-auto mb-8 mt-6 rounded-lg overflow-hidden shadow-md">
                        <img
                            :src="dish.image"
                            alt="Image of {{ dish.name }}"
                            class="w-full aspect-[3/2] object-cover"
                        />
                    </div>
                </div>

                <!-- Code for showing a dish goes here -->
                <!-- Tab navigation -->

                <div id="scroll-bar" class="fixed top-0 left-0 w-0 h-1 bg-blue-500 z-50"></div>

                <div>
                    <ul class="text-l font-medium mb-4 text-indigo-500 dark:text-blue-400">
                        <li><a href="#overview" class="hover:underline">- Overview </a></li>
                        <li><a href="#ingredients" class="hover:underline">- Ingredients </a></li>
                        <li><a href="#preparation" class="hover:underline">- Preparation</a></li>
                        <li><a href="#tips-story" class="hover:underline">- Tips & Story</a></li>
                    </ul>
                </div>

                <section id="overview" class="mb-8">
                    <h2 class="text-xl font-bold mb-2">Overview</h2>
                    <p>{{ dish.description }}</p>
                </section>

                <section id="ingredients" class="mb-8">
                    <h2 class="text-xl font-bold mb-2">Ingredients</h2>
                    <ul>
                        <li v-for="ingredient in dish.ingredients" :key="ingredient.id">‚Ä¢ {{ ingredient.name }} -
                            {{ ingredient.amount }} {{ ingredient.unit }}
                        </li>
                    </ul>
                </section>

                <section id="preparation" class="mb-8">
                    <h2 class="text-xl font-bold mb-4">üç≥ Preparation</h2>
                    <ol class="list-decimal pl-6 space-y-6">
                        <li v-for="step in dish.preparation_steps" :key="step.step_number">
                            <p class="font-medium mb-1">
                                Step {{ step.step_number }}
                                <span v-if="step.duration_minutes"> ‚Äî ‚è± {{ step.duration_minutes }} min</span>:
                            </p>

                            <img
                                v-if="step.image"
                                :src="step.image"
                                alt="Step image"
                                class="w-full max-w-md rounded shadow mt-3 mb-6"
                            />
                            <p class="mb-2">{{ step.instruction }}</p>
                        </li>
                    </ol>
                </section>


                <section id="tips-story" class="mb-8">
                    <h2 class="text-xl font-bold mb-2">Tips</h2>
                    <p>{{ dish.tips }}</p>
                </section>


                <div class="flex mt-8">
                    <AButton :href="`/`">
                        Back to Dishes
                    </AButton>

                    <AButton :href="`/dish/${dish.id}/edit`" class="mx-2">
                        <Pencil class="size-4 mr-1"/>
                        Edit Dish
                    </AButton>

                    <button
                        @click="deleteDish(dish.id)"
                        class="cursor-pointer inline-flex items-center px-3 py-2 text-sm font-medium text-center text-white rounded-lg focus:ring-4 focus:outline-none bg-red-600 focus:ring-red-100 dark:bg-red-500 dark:hover:bg-red-600 dark:focus:ring-red-700 hover:bg-red-700">
                        <Trash2 class="size-4 mr-1"/>
                        Delete Dish
                    </button>
                </div>

                <AComments :dish="dish"/>

                <AiPopupBot :show="showPopup" @close="showPopup = false"/>
            </div>
        </section>
    </Layout>
</template>

<script>
import Layout from '../Layout.vue';
import {Link} from '@inertiajs/vue3';
import AiPopupBot from "../components/AiPopupBot.vue"
import {onMounted, onUnmounted} from 'vue'
import {Utensils, Pencil, CornerUpLeft, Trash2} from "lucide-vue-next";
import AButton from "../components/AButton.vue";
import AComments from "../components/AComments.vue";
import {router} from "@inertiajs/vue3";


export default {
    components: {
        AButton,
        AComments,
        Utensils,
        Pencil,
        CornerUpLeft,
        Trash2,
        Layout,
        Link,
        AiPopupBot,
    },
    data() {
        return {
            showPopup: true,
        }
    },
    props: {
        dish: {
            type: Object,
            required: true
        }
    },
    methods: {
        deleteDish(id) {
            if (confirm("Are you sure?")) {
                router.delete(route('dishes.destroy', id), {
                    onSuccess: () => {
                        this.$inertia.visit('/')
                    }
                })
            }
        }
    },
    setup() {
        function updateScrollBar() {
            const winScroll = document.documentElement.scrollTop || document.body.scrollTop
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight
            const scrolled = (winScroll / height) * 100
            const el = document.getElementById('scroll-bar')
            if (el) {
                el.style.width = scrolled + '%'
            }
        }

        onMounted(() => {
            window.addEventListener('scroll', updateScrollBar)
        })

        onUnmounted(() => {
            window.removeEventListener('scroll', updateScrollBar)
        })
    }
}

</script>
